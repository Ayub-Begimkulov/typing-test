{"type":"typescript","text":"import { isObject } from \"./utils\";\nimport { StringToPath, stringToPath } from \"./string-to-path\";\nimport { AnyArray, AnyObject, Sequence, IsNumericKey } from \"./types\";\nimport { SetTuple, GetArrayValue, IsTuple } from \"./tuple\";\n\n// `StringPath` doesn't get distributed inside `Set_`, do it manually here\nexport type Set<\n  Obj extends AnyObject,\n  StringPath extends string,\n  Value\n> = StringPath extends unknown\n  ? Set_<Obj, StringToPath<StringPath>, Value>\n  : never;\n\ntype Set_<\n  Obj extends AnyObject,\n  Path extends string[],\n  Value,\n  Index extends number = 0\n> = {\n  0: Obj extends AnyArray\n    ? SetArray<Obj, Path, Value, Index>\n    : {\n        // writing this type inline because\n        // ts preserves type aliases in unions since 4.2\n        [K in keyof Obj | Path[Index]]: K extends Path[Index]\n          ? Set_<\n              GetNextObject<Obj[K], Path[Sequence[Index]]>,\n              Path,\n              Value,\n              Sequence[Index]\n            >\n          : Obj[K];\n      };\n  1: Path[\"length\"] extends 0 ? Obj : Value;\n}[Index extends Path[\"length\"] ? 1 : 0];\n\ntype SetArray<\n  Arr extends AnyArray,\n  Path extends string[],\n  Value,\n  Index extends number\n> = IsNumericKey<Path[Index]> extends false\n  ? // if object is an array but the key isn't numeric create and intersection type with object\n    Arr & Set_<{}, Path, Value, Index>\n  : IsTuple<Arr> extends false\n  ? (\n      | GetArrayValue<Arr>\n      | Set_<\n          GetNextObject<GetArrayValue<Arr>, Path[Sequence[Index]]>,\n          Path,\n          Value,\n          Sequence[Index]\n        >\n    )[]\n  : SetTuple<\n      Arr,\n      Path[Index],\n      Set_<\n        GetNextObject<Arr[Path[Index]], Path[Sequence[Index]]>,\n        Path,\n        Value,\n        Sequence[Index]\n      >\n    >;\n\ntype GetNextObject<Value, NextKey extends string> = [Value] extends [never]\n  ? DefaultObject<NextKey>\n  : Value extends AnyObject\n  ? Value\n  : DefaultObject<NextKey>;\n\ntype DefaultObject<Key extends string> = IsNumericKey<Key> extends true\n  ? []\n  : {};\n\ninterface SetFunction {\n  <Obj extends AnyObject, Path extends string, Value>(\n    object: Obj,\n    path: Path,\n    value: Value\n  ): Set<Obj, Path, Value>;\n}\n\nexport const set: SetFunction = (object, stringPath, value) => {\n  let index = -1;\n  const path = stringToPath(stringPath);\n  const lastIndex = path.length - 1;\n  let currentObject: AnyObject = object;\n\n  while (++index <= lastIndex) {\n    const key = path[index]!;\n    let newValue: unknown = value;\n\n    if (index !== lastIndex) {\n      const objValue = object[key]!;\n      newValue = isObject(objValue)\n        ? objValue\n        : !isNaN(+path[index + 1]!)\n        ? []\n        : {};\n    }\n    currentObject[key] = newValue;\n    currentObject = currentObject[key];\n  }\n  return object as any;\n};","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"isObject","type":"Identifier","range":[9,17]},{"text":"from","type":"Identifier","range":[20,24]},{"text":"\"./utils\"","type":"String","range":[25,34]},{"text":"import","type":"Keyword","range":[36,42]},{"text":"StringToPath","type":"Identifier","range":[45,57]},{"text":"stringToPath","type":"Identifier","range":[59,71]},{"text":"from","type":"Identifier","range":[74,78]},{"text":"\"./string-to-path\"","type":"String","range":[79,97]},{"text":"import","type":"Keyword","range":[99,105]},{"text":"AnyArray","type":"Identifier","range":[108,116]},{"text":"AnyObject","type":"Identifier","range":[118,127]},{"text":"Sequence","type":"Identifier","range":[129,137]},{"text":"IsNumericKey","type":"Identifier","range":[139,151]},{"text":"from","type":"Identifier","range":[154,158]},{"text":"\"./types\"","type":"String","range":[159,168]},{"text":"import","type":"Keyword","range":[170,176]},{"text":"SetTuple","type":"Identifier","range":[179,187]},{"text":"GetArrayValue","type":"Identifier","range":[189,202]},{"text":"IsTuple","type":"Identifier","range":[204,211]},{"text":"from","type":"Identifier","range":[214,218]},{"text":"\"./tuple\"","type":"String","range":[219,228]},{"text":" `StringPath` doesn't get distributed inside `Set_`, do it manually here","type":"Line","range":[231,305]},{"text":"export","type":"Keyword","range":[306,312]},{"text":"type","type":"Identifier","range":[313,317]},{"text":"Set","type":"Identifier","range":[318,321]},{"text":"Obj","type":"Identifier","range":[325,328]},{"text":"extends","type":"Keyword","range":[329,336]},{"text":"AnyObject","type":"Identifier","range":[337,346]},{"text":"StringPath","type":"Identifier","range":[350,360]},{"text":"extends","type":"Keyword","range":[361,368]},{"text":"string","type":"Identifier","range":[369,375]},{"text":"Value","type":"Identifier","range":[379,384]},{"text":"StringPath","type":"Identifier","range":[389,399]},{"text":"extends","type":"Keyword","range":[400,407]},{"text":"unknown","type":"Identifier","range":[408,415]},{"text":"Set_","type":"Identifier","range":[420,424]},{"text":"Obj","type":"Identifier","range":[425,428]},{"text":"StringToPath","type":"Identifier","range":[430,442]},{"text":"StringPath","type":"Identifier","range":[443,453]},{"text":"Value","type":"Identifier","range":[456,461]},{"text":"never","type":"Identifier","range":[467,472]},{"text":"type","type":"Identifier","range":[475,479]},{"text":"Set_","type":"Identifier","range":[480,484]},{"text":"Obj","type":"Identifier","range":[488,491]},{"text":"extends","type":"Keyword","range":[492,499]},{"text":"AnyObject","type":"Identifier","range":[500,509]},{"text":"Path","type":"Identifier","range":[513,517]},{"text":"extends","type":"Keyword","range":[518,525]},{"text":"string","type":"Identifier","range":[526,532]},{"text":"Value","type":"Identifier","range":[538,543]},{"text":"Index","type":"Identifier","range":[547,552]},{"text":"extends","type":"Keyword","range":[553,560]},{"text":"number","type":"Identifier","range":[561,567]},{"text":"0","type":"Numeric","range":[570,571]},{"text":"0","type":"Numeric","range":[580,581]},{"text":"Obj","type":"Identifier","range":[583,586]},{"text":"extends","type":"Keyword","range":[587,594]},{"text":"AnyArray","type":"Identifier","range":[595,603]},{"text":"SetArray","type":"Identifier","range":[610,618]},{"text":"Obj","type":"Identifier","range":[619,622]},{"text":"Path","type":"Identifier","range":[624,628]},{"text":"Value","type":"Identifier","range":[630,635]},{"text":"Index","type":"Identifier","range":[637,642]},{"text":" writing this type inline because","type":"Line","range":[660,695]},{"text":" ts preserves type aliases in unions since 4.2","type":"Line","range":[704,752]},{"text":"K","type":"Identifier","range":[762,763]},{"text":"in","type":"Keyword","range":[764,766]},{"text":"keyof","type":"Identifier","range":[767,772]},{"text":"Obj","type":"Identifier","range":[773,776]},{"text":"Path","type":"Identifier","range":[779,783]},{"text":"Index","type":"Identifier","range":[784,789]},{"text":"K","type":"Identifier","range":[793,794]},{"text":"extends","type":"Keyword","range":[795,802]},{"text":"Path","type":"Identifier","range":[803,807]},{"text":"Index","type":"Identifier","range":[808,813]},{"text":"Set_","type":"Identifier","range":[827,831]},{"text":"GetNextObject","type":"Identifier","range":[847,860]},{"text":"Obj","type":"Identifier","range":[861,864]},{"text":"K","type":"Identifier","range":[865,866]},{"text":"Path","type":"Identifier","range":[869,873]},{"text":"Sequence","type":"Identifier","range":[874,882]},{"text":"Index","type":"Identifier","range":[883,888]},{"text":"Path","type":"Identifier","range":[907,911]},{"text":"Value","type":"Identifier","range":[927,932]},{"text":"Sequence","type":"Identifier","range":[948,956]},{"text":"Index","type":"Identifier","range":[957,962]},{"text":"Obj","type":"Identifier","range":[990,993]},{"text":"K","type":"Identifier","range":[994,995]},{"text":"1","type":"Numeric","range":[1009,1010]},{"text":"Path","type":"Identifier","range":[1012,1016]},{"text":"\"length\"","type":"String","range":[1017,1025]},{"text":"extends","type":"Keyword","range":[1027,1034]},{"text":"0","type":"Numeric","range":[1035,1036]},{"text":"Obj","type":"Identifier","range":[1039,1042]},{"text":"Value","type":"Identifier","range":[1045,1050]},{"text":"Index","type":"Identifier","range":[1054,1059]},{"text":"extends","type":"Keyword","range":[1060,1067]},{"text":"Path","type":"Identifier","range":[1068,1072]},{"text":"\"length\"","type":"String","range":[1073,1081]},{"text":"1","type":"Numeric","range":[1085,1086]},{"text":"0","type":"Numeric","range":[1089,1090]},{"text":"type","type":"Identifier","range":[1094,1098]},{"text":"SetArray","type":"Identifier","range":[1099,1107]},{"text":"Arr","type":"Identifier","range":[1111,1114]},{"text":"extends","type":"Keyword","range":[1115,1122]},{"text":"AnyArray","type":"Identifier","range":[1123,1131]},{"text":"Path","type":"Identifier","range":[1135,1139]},{"text":"extends","type":"Keyword","range":[1140,1147]},{"text":"string","type":"Identifier","range":[1148,1154]},{"text":"Value","type":"Identifier","range":[1160,1165]},{"text":"Index","type":"Identifier","range":[1169,1174]},{"text":"extends","type":"Keyword","range":[1175,1182]},{"text":"number","type":"Identifier","range":[1183,1189]},{"text":"IsNumericKey","type":"Identifier","range":[1194,1206]},{"text":"Path","type":"Identifier","range":[1207,1211]},{"text":"Index","type":"Identifier","range":[1212,1217]},{"text":"extends","type":"Keyword","range":[1220,1227]},{"text":"false","type":"Boolean","range":[1228,1233]},{"text":" if object is an array but the key isn't numeric create and intersection type with object","type":"Line","range":[1238,1329]},{"text":"Arr","type":"Identifier","range":[1334,1337]},{"text":"Set_","type":"Identifier","range":[1340,1344]},{"text":"Path","type":"Identifier","range":[1349,1353]},{"text":"Value","type":"Identifier","range":[1355,1360]},{"text":"Index","type":"Identifier","range":[1362,1367]},{"text":"IsTuple","type":"Identifier","range":[1373,1380]},{"text":"Arr","type":"Identifier","range":[1381,1384]},{"text":"extends","type":"Keyword","range":[1386,1393]},{"text":"false","type":"Boolean","range":[1394,1399]},{"text":"GetArrayValue","type":"Identifier","range":[1414,1427]},{"text":"Arr","type":"Identifier","range":[1428,1431]},{"text":"Set_","type":"Identifier","range":[1441,1445]},{"text":"GetNextObject","type":"Identifier","range":[1457,1470]},{"text":"GetArrayValue","type":"Identifier","range":[1471,1484]},{"text":"Arr","type":"Identifier","range":[1485,1488]},{"text":"Path","type":"Identifier","range":[1491,1495]},{"text":"Sequence","type":"Identifier","range":[1496,1504]},{"text":"Index","type":"Identifier","range":[1505,1510]},{"text":"Path","type":"Identifier","range":[1525,1529]},{"text":"Value","type":"Identifier","range":[1541,1546]},{"text":"Sequence","type":"Identifier","range":[1558,1566]},{"text":"Index","type":"Identifier","range":[1567,1572]},{"text":"SetTuple","type":"Identifier","range":[1596,1604]},{"text":"Arr","type":"Identifier","range":[1612,1615]},{"text":"Path","type":"Identifier","range":[1623,1627]},{"text":"Index","type":"Identifier","range":[1628,1633]},{"text":"Set_","type":"Identifier","range":[1642,1646]},{"text":"GetNextObject","type":"Identifier","range":[1656,1669]},{"text":"Arr","type":"Identifier","range":[1670,1673]},{"text":"Path","type":"Identifier","range":[1674,1678]},{"text":"Index","type":"Identifier","range":[1679,1684]},{"text":"Path","type":"Identifier","range":[1688,1692]},{"text":"Sequence","type":"Identifier","range":[1693,1701]},{"text":"Index","type":"Identifier","range":[1702,1707]},{"text":"Path","type":"Identifier","range":[1720,1724]},{"text":"Value","type":"Identifier","range":[1734,1739]},{"text":"Sequence","type":"Identifier","range":[1749,1757]},{"text":"Index","type":"Identifier","range":[1758,1763]},{"text":"type","type":"Identifier","range":[1781,1785]},{"text":"GetNextObject","type":"Identifier","range":[1786,1799]},{"text":"Value","type":"Identifier","range":[1800,1805]},{"text":"NextKey","type":"Identifier","range":[1807,1814]},{"text":"extends","type":"Keyword","range":[1815,1822]},{"text":"string","type":"Identifier","range":[1823,1829]},{"text":"Value","type":"Identifier","range":[1834,1839]},{"text":"extends","type":"Keyword","range":[1841,1848]},{"text":"never","type":"Identifier","range":[1850,1855]},{"text":"DefaultObject","type":"Identifier","range":[1861,1874]},{"text":"NextKey","type":"Identifier","range":[1875,1882]},{"text":"Value","type":"Identifier","range":[1888,1893]},{"text":"extends","type":"Keyword","range":[1894,1901]},{"text":"AnyObject","type":"Identifier","range":[1902,1911]},{"text":"Value","type":"Identifier","range":[1916,1921]},{"text":"DefaultObject","type":"Identifier","range":[1926,1939]},{"text":"NextKey","type":"Identifier","range":[1940,1947]},{"text":"type","type":"Identifier","range":[1951,1955]},{"text":"DefaultObject","type":"Identifier","range":[1956,1969]},{"text":"Key","type":"Identifier","range":[1970,1973]},{"text":"extends","type":"Keyword","range":[1974,1981]},{"text":"string","type":"Identifier","range":[1982,1988]},{"text":"IsNumericKey","type":"Identifier","range":[1992,2004]},{"text":"Key","type":"Identifier","range":[2005,2008]},{"text":"extends","type":"Keyword","range":[2010,2017]},{"text":"true","type":"Boolean","range":[2018,2022]},{"text":"interface","type":"Keyword","range":[2039,2048]},{"text":"SetFunction","type":"Identifier","range":[2049,2060]},{"text":"Obj","type":"Identifier","range":[2066,2069]},{"text":"extends","type":"Keyword","range":[2070,2077]},{"text":"AnyObject","type":"Identifier","range":[2078,2087]},{"text":"Path","type":"Identifier","range":[2089,2093]},{"text":"extends","type":"Keyword","range":[2094,2101]},{"text":"string","type":"Identifier","range":[2102,2108]},{"text":"Value","type":"Identifier","range":[2110,2115]},{"text":"object","type":"Identifier","range":[2122,2128]},{"text":"Obj","type":"Identifier","range":[2130,2133]},{"text":"path","type":"Identifier","range":[2139,2143]},{"text":"Path","type":"Identifier","range":[2145,2149]},{"text":"value","type":"Identifier","range":[2155,2160]},{"text":"Value","type":"Identifier","range":[2162,2167]},{"text":"Set","type":"Identifier","range":[2173,2176]},{"text":"Obj","type":"Identifier","range":[2177,2180]},{"text":"Path","type":"Identifier","range":[2182,2186]},{"text":"Value","type":"Identifier","range":[2188,2193]},{"text":"export","type":"Keyword","range":[2199,2205]},{"text":"const","type":"Keyword","range":[2206,2211]},{"text":"set","type":"Identifier","range":[2212,2215]},{"text":"SetFunction","type":"Identifier","range":[2217,2228]},{"text":"object","type":"Identifier","range":[2232,2238]},{"text":"stringPath","type":"Identifier","range":[2240,2250]},{"text":"value","type":"Identifier","range":[2252,2257]},{"text":"let","type":"Keyword","range":[2266,2269]},{"text":"index","type":"Identifier","range":[2270,2275]},{"text":"1","type":"Numeric","range":[2279,2280]},{"text":"const","type":"Keyword","range":[2284,2289]},{"text":"path","type":"Identifier","range":[2290,2294]},{"text":"stringToPath","type":"Identifier","range":[2297,2309]},{"text":"stringPath","type":"Identifier","range":[2310,2320]},{"text":"const","type":"Keyword","range":[2325,2330]},{"text":"lastIndex","type":"Identifier","range":[2331,2340]},{"text":"path","type":"Identifier","range":[2343,2347]},{"text":"length","type":"Identifier","range":[2348,2354]},{"text":"1","type":"Numeric","range":[2357,2358]},{"text":"let","type":"Keyword","range":[2362,2365]},{"text":"currentObject","type":"Identifier","range":[2366,2379]},{"text":"AnyObject","type":"Identifier","range":[2381,2390]},{"text":"object","type":"Identifier","range":[2393,2399]},{"text":"while","type":"Keyword","range":[2404,2409]},{"text":"index","type":"Identifier","range":[2413,2418]},{"text":"lastIndex","type":"Identifier","range":[2422,2431]},{"text":"const","type":"Keyword","range":[2439,2444]},{"text":"key","type":"Identifier","range":[2445,2448]},{"text":"path","type":"Identifier","range":[2451,2455]},{"text":"index","type":"Identifier","range":[2456,2461]},{"text":"let","type":"Keyword","range":[2469,2472]},{"text":"newValue","type":"Identifier","range":[2473,2481]},{"text":"unknown","type":"Identifier","range":[2483,2490]},{"text":"value","type":"Identifier","range":[2493,2498]},{"text":"if","type":"Keyword","range":[2505,2507]},{"text":"index","type":"Identifier","range":[2509,2514]},{"text":"lastIndex","type":"Identifier","range":[2519,2528]},{"text":"const","type":"Keyword","range":[2538,2543]},{"text":"objValue","type":"Identifier","range":[2544,2552]},{"text":"object","type":"Identifier","range":[2555,2561]},{"text":"key","type":"Identifier","range":[2562,2565]},{"text":"newValue","type":"Identifier","range":[2575,2583]},{"text":"isObject","type":"Identifier","range":[2586,2594]},{"text":"objValue","type":"Identifier","range":[2595,2603]},{"text":"objValue","type":"Identifier","range":[2615,2623]},{"text":"isNaN","type":"Identifier","range":[2635,2640]},{"text":"path","type":"Identifier","range":[2642,2646]},{"text":"index","type":"Identifier","range":[2647,2652]},{"text":"1","type":"Numeric","range":[2655,2656]},{"text":"currentObject","type":"Identifier","range":[2697,2710]},{"text":"key","type":"Identifier","range":[2711,2714]},{"text":"newValue","type":"Identifier","range":[2718,2726]},{"text":"currentObject","type":"Identifier","range":[2732,2745]},{"text":"currentObject","type":"Identifier","range":[2748,2761]},{"text":"key","type":"Identifier","range":[2762,2765]},{"text":"return","type":"Keyword","range":[2774,2780]},{"text":"object","type":"Identifier","range":[2781,2787]},{"text":"as","type":"Identifier","range":[2788,2790]},{"text":"any","type":"Identifier","range":[2791,2794]}]}