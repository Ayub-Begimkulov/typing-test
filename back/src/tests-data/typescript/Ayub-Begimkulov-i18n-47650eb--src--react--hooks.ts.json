{"type":"typescript","text":"import {\n  useCallback,\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\nimport type { I18N } from \"../i18n\";\nimport { I18NContext } from \"./context\";\n\nfunction useI18NContext() {\n  const i18n = useContext(I18NContext);\n\n  if (!i18n) {\n    throw new Error(\"can not `useI18NContext` outside of the `I18NProvider`\");\n  }\n\n  return i18n;\n}\n\ninterface ReactI18N<I18NType extends I18N<any>> {\n  readonly lang: ReturnType<I18NType[\"getLang\"]>;\n  get: I18NType[\"get\"];\n  /**\n   * @deprecated use `lang` instead\n   */\n  getLang: I18NType[\"getLang\"];\n  setLang: I18NType[\"setLang\"];\n  subscribe: I18NType[\"subscribe\"];\n}\n\nexport function useI18N<I18NType extends I18N<any>>() {\n  const i18n = useI18NContext() as I18NType;\n  const [{ langState, updateCount }, setLangState] = useState(() => ({\n    langState: i18n.getLang(),\n    updateCount: 0,\n  }));\n  const usesLang = useRef(false);\n\n  useEffect(() => {\n    i18n.subscribe((lang) => {\n      // only update the state if\n      // the lang is used\n      if (!usesLang.current) {\n        return;\n      }\n\n      setLangState((state) => ({\n        langState: lang,\n        updateCount: state.updateCount + 1,\n      }));\n    });\n  }, [i18n]);\n\n  const get: typeof i18n.get = useCallback(\n    (key, ...rest) => {\n      usesLang.current = true;\n      return i18n.get(key, ...rest);\n    },\n    // include the `updateCount` into the deps array\n    // so that `get` function changes it's reference whenever\n    // the languages changes or the translations are loaded\n    [i18n, updateCount]\n  );\n\n  const getLang: typeof i18n.getLang = useCallback(\n    () => {\n      usesLang.current = true;\n      return i18n.getLang();\n    },\n    // include the `langState` into the deps array\n    // so that `get` function changes it's reference whenever\n    // the languages changes\n    [i18n, langState]\n  );\n\n  const setLang: typeof i18n.setLang = useCallback(\n    (newLang) => i18n.setLang(newLang),\n    [i18n]\n  );\n\n  const subscribe: typeof i18n.subscribe = useCallback(\n    (cb, options) => i18n.subscribe(cb, options),\n    [i18n]\n  );\n\n  const reactI18N = {\n    get lang() {\n      usesLang.current = true;\n      return langState;\n    },\n    get,\n    getLang,\n    setLang,\n    subscribe,\n  } as ReactI18N<I18NType>;\n\n  return reactI18N;\n}\n\nexport function useTranslate<I18NType extends I18N<any>>() {\n  const i18n = useI18NContext();\n  const [updateCount, triggerUpdate] = useReducer((v) => v + 1, 0);\n\n  useEffect(() => {\n    return i18n.subscribe(() => {\n      triggerUpdate();\n    });\n  }, []);\n\n  const translate: I18NType[\"get\"] = useCallback(\n    (key, ...rest) => {\n      return i18n.get(key, ...rest);\n    },\n    // include the `updateCount` into the deps array\n    // so that translate changes it's reference whenever the language changes\n    [updateCount]\n  );\n\n  return translate;\n}","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"useCallback","type":"Identifier","range":[11,22]},{"text":"useContext","type":"Identifier","range":[26,36]},{"text":"useEffect","type":"Identifier","range":[40,49]},{"text":"useReducer","type":"Identifier","range":[53,63]},{"text":"useRef","type":"Identifier","range":[67,73]},{"text":"useState","type":"Identifier","range":[77,85]},{"text":"from","type":"Identifier","range":[89,93]},{"text":"\"react\"","type":"String","range":[94,101]},{"text":"import","type":"Keyword","range":[103,109]},{"text":"type","type":"Identifier","range":[110,114]},{"text":"I18N","type":"Identifier","range":[117,121]},{"text":"from","type":"Identifier","range":[124,128]},{"text":"\"../i18n\"","type":"String","range":[129,138]},{"text":"import","type":"Keyword","range":[140,146]},{"text":"I18NContext","type":"Identifier","range":[149,160]},{"text":"from","type":"Identifier","range":[163,167]},{"text":"\"./context\"","type":"String","range":[168,179]},{"text":"function","type":"Keyword","range":[182,190]},{"text":"useI18NContext","type":"Identifier","range":[191,205]},{"text":"const","type":"Keyword","range":[212,217]},{"text":"i18n","type":"Identifier","range":[218,222]},{"text":"useContext","type":"Identifier","range":[225,235]},{"text":"I18NContext","type":"Identifier","range":[236,247]},{"text":"if","type":"Keyword","range":[253,255]},{"text":"i18n","type":"Identifier","range":[258,262]},{"text":"throw","type":"Keyword","range":[270,275]},{"text":"new","type":"Keyword","range":[276,279]},{"text":"Error","type":"Identifier","range":[280,285]},{"text":"\"can not `useI18NContext` outside of the `I18NProvider`\"","type":"String","range":[286,342]},{"text":"return","type":"Keyword","range":[352,358]},{"text":"i18n","type":"Identifier","range":[359,363]},{"text":"interface","type":"Keyword","range":[368,377]},{"text":"ReactI18N","type":"Identifier","range":[378,387]},{"text":"I18NType","type":"Identifier","range":[388,396]},{"text":"extends","type":"Keyword","range":[397,404]},{"text":"I18N","type":"Identifier","range":[405,409]},{"text":"any","type":"Identifier","range":[410,413]},{"text":"readonly","type":"Identifier","range":[420,428]},{"text":"lang","type":"Identifier","range":[429,433]},{"text":"ReturnType","type":"Identifier","range":[435,445]},{"text":"I18NType","type":"Identifier","range":[446,454]},{"text":"\"getLang\"","type":"String","range":[455,464]},{"text":"get","type":"Identifier","range":[470,473]},{"text":"I18NType","type":"Identifier","range":[475,483]},{"text":"\"get\"","type":"String","range":[484,489]},{"text":"*\n   * @deprecated use `lang` instead\n   ","type":"Block","range":[494,539]},{"text":"getLang","type":"Identifier","range":[542,549]},{"text":"I18NType","type":"Identifier","range":[551,559]},{"text":"\"getLang\"","type":"String","range":[560,569]},{"text":"setLang","type":"Identifier","range":[574,581]},{"text":"I18NType","type":"Identifier","range":[583,591]},{"text":"\"setLang\"","type":"String","range":[592,601]},{"text":"subscribe","type":"Identifier","range":[606,615]},{"text":"I18NType","type":"Identifier","range":[617,625]},{"text":"\"subscribe\"","type":"String","range":[626,637]},{"text":"export","type":"Keyword","range":[643,649]},{"text":"function","type":"Keyword","range":[650,658]},{"text":"useI18N","type":"Identifier","range":[659,666]},{"text":"I18NType","type":"Identifier","range":[667,675]},{"text":"extends","type":"Keyword","range":[676,683]},{"text":"I18N","type":"Identifier","range":[684,688]},{"text":"any","type":"Identifier","range":[689,692]},{"text":"const","type":"Keyword","range":[701,706]},{"text":"i18n","type":"Identifier","range":[707,711]},{"text":"useI18NContext","type":"Identifier","range":[714,728]},{"text":"as","type":"Identifier","range":[731,733]},{"text":"I18NType","type":"Identifier","range":[734,742]},{"text":"const","type":"Keyword","range":[746,751]},{"text":"langState","type":"Identifier","range":[755,764]},{"text":"updateCount","type":"Identifier","range":[766,777]},{"text":"setLangState","type":"Identifier","range":[781,793]},{"text":"useState","type":"Identifier","range":[797,805]},{"text":"langState","type":"Identifier","range":[819,828]},{"text":"i18n","type":"Identifier","range":[830,834]},{"text":"getLang","type":"Identifier","range":[835,842]},{"text":"updateCount","type":"Identifier","range":[850,861]},{"text":"0","type":"Numeric","range":[863,864]},{"text":"const","type":"Keyword","range":[875,880]},{"text":"usesLang","type":"Identifier","range":[881,889]},{"text":"useRef","type":"Identifier","range":[892,898]},{"text":"false","type":"Boolean","range":[899,904]},{"text":"useEffect","type":"Identifier","range":[910,919]},{"text":"i18n","type":"Identifier","range":[932,936]},{"text":"subscribe","type":"Identifier","range":[937,946]},{"text":"lang","type":"Identifier","range":[948,952]},{"text":" only update the state if","type":"Line","range":[965,992]},{"text":" the lang is used","type":"Line","range":[999,1018]},{"text":"if","type":"Keyword","range":[1025,1027]},{"text":"usesLang","type":"Identifier","range":[1030,1038]},{"text":"current","type":"Identifier","range":[1039,1046]},{"text":"return","type":"Keyword","range":[1058,1064]},{"text":"setLangState","type":"Identifier","range":[1081,1093]},{"text":"state","type":"Identifier","range":[1095,1100]},{"text":"langState","type":"Identifier","range":[1116,1125]},{"text":"lang","type":"Identifier","range":[1127,1131]},{"text":"updateCount","type":"Identifier","range":[1141,1152]},{"text":"state","type":"Identifier","range":[1154,1159]},{"text":"updateCount","type":"Identifier","range":[1160,1171]},{"text":"1","type":"Numeric","range":[1174,1175]},{"text":"i18n","type":"Identifier","range":[1202,1206]},{"text":"const","type":"Keyword","range":[1213,1218]},{"text":"get","type":"Identifier","range":[1219,1222]},{"text":"typeof","type":"Keyword","range":[1224,1230]},{"text":"i18n","type":"Identifier","range":[1231,1235]},{"text":"get","type":"Identifier","range":[1236,1239]},{"text":"useCallback","type":"Identifier","range":[1242,1253]},{"text":"key","type":"Identifier","range":[1260,1263]},{"text":"rest","type":"Identifier","range":[1268,1272]},{"text":"usesLang","type":"Identifier","range":[1285,1293]},{"text":"current","type":"Identifier","range":[1294,1301]},{"text":"true","type":"Boolean","range":[1304,1308]},{"text":"return","type":"Keyword","range":[1316,1322]},{"text":"i18n","type":"Identifier","range":[1323,1327]},{"text":"get","type":"Identifier","range":[1328,1331]},{"text":"key","type":"Identifier","range":[1332,1335]},{"text":"rest","type":"Identifier","range":[1340,1344]},{"text":" include the `updateCount` into the deps array","type":"Line","range":[1358,1406]},{"text":" so that `get` function changes it's reference whenever","type":"Line","range":[1411,1468]},{"text":" the languages changes or the translations are loaded","type":"Line","range":[1473,1528]},{"text":"i18n","type":"Identifier","range":[1534,1538]},{"text":"updateCount","type":"Identifier","range":[1540,1551]},{"text":"const","type":"Keyword","range":[1561,1566]},{"text":"getLang","type":"Identifier","range":[1567,1574]},{"text":"typeof","type":"Keyword","range":[1576,1582]},{"text":"i18n","type":"Identifier","range":[1583,1587]},{"text":"getLang","type":"Identifier","range":[1588,1595]},{"text":"useCallback","type":"Identifier","range":[1598,1609]},{"text":"usesLang","type":"Identifier","range":[1629,1637]},{"text":"current","type":"Identifier","range":[1638,1645]},{"text":"true","type":"Boolean","range":[1648,1652]},{"text":"return","type":"Keyword","range":[1660,1666]},{"text":"i18n","type":"Identifier","range":[1667,1671]},{"text":"getLang","type":"Identifier","range":[1672,1679]},{"text":" include the `langState` into the deps array","type":"Line","range":[1694,1740]},{"text":" so that `get` function changes it's reference whenever","type":"Line","range":[1745,1802]},{"text":" the languages changes","type":"Line","range":[1807,1831]},{"text":"i18n","type":"Identifier","range":[1837,1841]},{"text":"langState","type":"Identifier","range":[1843,1852]},{"text":"const","type":"Keyword","range":[1862,1867]},{"text":"setLang","type":"Identifier","range":[1868,1875]},{"text":"typeof","type":"Keyword","range":[1877,1883]},{"text":"i18n","type":"Identifier","range":[1884,1888]},{"text":"setLang","type":"Identifier","range":[1889,1896]},{"text":"useCallback","type":"Identifier","range":[1899,1910]},{"text":"newLang","type":"Identifier","range":[1917,1924]},{"text":"i18n","type":"Identifier","range":[1929,1933]},{"text":"setLang","type":"Identifier","range":[1934,1941]},{"text":"newLang","type":"Identifier","range":[1942,1949]},{"text":"i18n","type":"Identifier","range":[1957,1961]},{"text":"const","type":"Keyword","range":[1971,1976]},{"text":"subscribe","type":"Identifier","range":[1977,1986]},{"text":"typeof","type":"Keyword","range":[1988,1994]},{"text":"i18n","type":"Identifier","range":[1995,1999]},{"text":"subscribe","type":"Identifier","range":[2000,2009]},{"text":"useCallback","type":"Identifier","range":[2012,2023]},{"text":"cb","type":"Identifier","range":[2030,2032]},{"text":"options","type":"Identifier","range":[2034,2041]},{"text":"i18n","type":"Identifier","range":[2046,2050]},{"text":"subscribe","type":"Identifier","range":[2051,2060]},{"text":"cb","type":"Identifier","range":[2061,2063]},{"text":"options","type":"Identifier","range":[2065,2072]},{"text":"i18n","type":"Identifier","range":[2080,2084]},{"text":"const","type":"Keyword","range":[2094,2099]},{"text":"reactI18N","type":"Identifier","range":[2100,2109]},{"text":"get","type":"Identifier","range":[2118,2121]},{"text":"lang","type":"Identifier","range":[2122,2126]},{"text":"usesLang","type":"Identifier","range":[2137,2145]},{"text":"current","type":"Identifier","range":[2146,2153]},{"text":"true","type":"Boolean","range":[2156,2160]},{"text":"return","type":"Keyword","range":[2168,2174]},{"text":"langState","type":"Identifier","range":[2175,2184]},{"text":"get","type":"Identifier","range":[2197,2200]},{"text":"getLang","type":"Identifier","range":[2206,2213]},{"text":"setLang","type":"Identifier","range":[2219,2226]},{"text":"subscribe","type":"Identifier","range":[2232,2241]},{"text":"as","type":"Identifier","range":[2247,2249]},{"text":"ReactI18N","type":"Identifier","range":[2250,2259]},{"text":"I18NType","type":"Identifier","range":[2260,2268]},{"text":"return","type":"Keyword","range":[2274,2280]},{"text":"reactI18N","type":"Identifier","range":[2281,2290]},{"text":"export","type":"Keyword","range":[2295,2301]},{"text":"function","type":"Keyword","range":[2302,2310]},{"text":"useTranslate","type":"Identifier","range":[2311,2323]},{"text":"I18NType","type":"Identifier","range":[2324,2332]},{"text":"extends","type":"Keyword","range":[2333,2340]},{"text":"I18N","type":"Identifier","range":[2341,2345]},{"text":"any","type":"Identifier","range":[2346,2349]},{"text":"const","type":"Keyword","range":[2358,2363]},{"text":"i18n","type":"Identifier","range":[2364,2368]},{"text":"useI18NContext","type":"Identifier","range":[2371,2385]},{"text":"const","type":"Keyword","range":[2391,2396]},{"text":"updateCount","type":"Identifier","range":[2398,2409]},{"text":"triggerUpdate","type":"Identifier","range":[2411,2424]},{"text":"useReducer","type":"Identifier","range":[2428,2438]},{"text":"v","type":"Identifier","range":[2440,2441]},{"text":"v","type":"Identifier","range":[2446,2447]},{"text":"1","type":"Numeric","range":[2450,2451]},{"text":"0","type":"Numeric","range":[2453,2454]},{"text":"useEffect","type":"Identifier","range":[2460,2469]},{"text":"return","type":"Keyword","range":[2482,2488]},{"text":"i18n","type":"Identifier","range":[2489,2493]},{"text":"subscribe","type":"Identifier","range":[2494,2503]},{"text":"triggerUpdate","type":"Identifier","range":[2518,2531]},{"text":"const","type":"Keyword","range":[2556,2561]},{"text":"translate","type":"Identifier","range":[2562,2571]},{"text":"I18NType","type":"Identifier","range":[2573,2581]},{"text":"\"get\"","type":"String","range":[2582,2587]},{"text":"useCallback","type":"Identifier","range":[2591,2602]},{"text":"key","type":"Identifier","range":[2609,2612]},{"text":"rest","type":"Identifier","range":[2617,2621]},{"text":"return","type":"Keyword","range":[2634,2640]},{"text":"i18n","type":"Identifier","range":[2641,2645]},{"text":"get","type":"Identifier","range":[2646,2649]},{"text":"key","type":"Identifier","range":[2650,2653]},{"text":"rest","type":"Identifier","range":[2658,2662]},{"text":" include the `updateCount` into the deps array","type":"Line","range":[2676,2724]},{"text":" so that translate changes it's reference whenever the language changes","type":"Line","range":[2729,2802]},{"text":"updateCount","type":"Identifier","range":[2808,2819]},{"text":"return","type":"Keyword","range":[2829,2835]},{"text":"translate","type":"Identifier","range":[2836,2845]}]}