{"type":"typescript","text":"import { isObject, hasChanged } from \"../utils\";\nimport { AnyObject } from \"../types\";\nimport { addReaction, runReactions, storeObservable } from \"./store\";\n\nconst rawToProxy = new WeakMap<AnyObject, AnyObject>();\nconst proxyToRaw = new WeakMap<AnyObject, AnyObject>();\n\nexport const observable = <T extends AnyObject = AnyObject>(raw: T) => {\n  if (proxyToRaw.has(raw)) return raw;\n  return (rawToProxy.get(raw) as T) || createObservable(raw);\n};\n\nconst createObservable = <T extends AnyObject>(target: T) => {\n  const observable = Object.entries(target).reduce((result, [key, value]) => {\n    return addPropertyToObservable(result, key, value);\n  }, {} as T);\n\n  storeObservable(observable);\n\n  rawToProxy.set(target, observable);\n  proxyToRaw.set(observable, target);\n\n  return observable;\n};\n\nconst addPropertyToObservable = <T extends AnyObject, K>(\n  target: T,\n  key: string,\n  value: K\n) => {\n  let currentValue = value;\n  Object.defineProperty(target, key, {\n    get() {\n      addReaction(target, key);\n      return isObject(currentValue) ? observable(currentValue) : currentValue;\n    },\n    set(newValue) {\n      if (hasChanged(currentValue, newValue)) {\n        currentValue = newValue;\n        runReactions(target, key);\n      }\n    },\n  });\n\n  return target;\n};","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"isObject","type":"Identifier","range":[9,17]},{"text":"hasChanged","type":"Identifier","range":[19,29]},{"text":"from","type":"Identifier","range":[32,36]},{"text":"\"../utils\"","type":"String","range":[37,47]},{"text":"import","type":"Keyword","range":[49,55]},{"text":"AnyObject","type":"Identifier","range":[58,67]},{"text":"from","type":"Identifier","range":[70,74]},{"text":"\"../types\"","type":"String","range":[75,85]},{"text":"import","type":"Keyword","range":[87,93]},{"text":"addReaction","type":"Identifier","range":[96,107]},{"text":"runReactions","type":"Identifier","range":[109,121]},{"text":"storeObservable","type":"Identifier","range":[123,138]},{"text":"from","type":"Identifier","range":[141,145]},{"text":"\"./store\"","type":"String","range":[146,155]},{"text":"const","type":"Keyword","range":[158,163]},{"text":"rawToProxy","type":"Identifier","range":[164,174]},{"text":"new","type":"Keyword","range":[177,180]},{"text":"WeakMap","type":"Identifier","range":[181,188]},{"text":"AnyObject","type":"Identifier","range":[189,198]},{"text":"AnyObject","type":"Identifier","range":[200,209]},{"text":"const","type":"Keyword","range":[214,219]},{"text":"proxyToRaw","type":"Identifier","range":[220,230]},{"text":"new","type":"Keyword","range":[233,236]},{"text":"WeakMap","type":"Identifier","range":[237,244]},{"text":"AnyObject","type":"Identifier","range":[245,254]},{"text":"AnyObject","type":"Identifier","range":[256,265]},{"text":"export","type":"Keyword","range":[271,277]},{"text":"const","type":"Keyword","range":[278,283]},{"text":"observable","type":"Identifier","range":[284,294]},{"text":"T","type":"Identifier","range":[298,299]},{"text":"extends","type":"Keyword","range":[300,307]},{"text":"AnyObject","type":"Identifier","range":[308,317]},{"text":"AnyObject","type":"Identifier","range":[320,329]},{"text":"raw","type":"Identifier","range":[331,334]},{"text":"T","type":"Identifier","range":[336,337]},{"text":"if","type":"Keyword","range":[346,348]},{"text":"proxyToRaw","type":"Identifier","range":[350,360]},{"text":"has","type":"Identifier","range":[361,364]},{"text":"raw","type":"Identifier","range":[365,368]},{"text":"return","type":"Keyword","range":[371,377]},{"text":"raw","type":"Identifier","range":[378,381]},{"text":"return","type":"Keyword","range":[385,391]},{"text":"rawToProxy","type":"Identifier","range":[393,403]},{"text":"get","type":"Identifier","range":[404,407]},{"text":"raw","type":"Identifier","range":[408,411]},{"text":"as","type":"Identifier","range":[413,415]},{"text":"T","type":"Identifier","range":[416,417]},{"text":"createObservable","type":"Identifier","range":[422,438]},{"text":"raw","type":"Identifier","range":[439,442]},{"text":"const","type":"Keyword","range":[449,454]},{"text":"createObservable","type":"Identifier","range":[455,471]},{"text":"T","type":"Identifier","range":[475,476]},{"text":"extends","type":"Keyword","range":[477,484]},{"text":"AnyObject","type":"Identifier","range":[485,494]},{"text":"target","type":"Identifier","range":[496,502]},{"text":"T","type":"Identifier","range":[504,505]},{"text":"const","type":"Keyword","range":[514,519]},{"text":"observable","type":"Identifier","range":[520,530]},{"text":"Object","type":"Identifier","range":[533,539]},{"text":"entries","type":"Identifier","range":[540,547]},{"text":"target","type":"Identifier","range":[548,554]},{"text":"reduce","type":"Identifier","range":[556,562]},{"text":"result","type":"Identifier","range":[564,570]},{"text":"key","type":"Identifier","range":[573,576]},{"text":"value","type":"Identifier","range":[578,583]},{"text":"return","type":"Keyword","range":[595,601]},{"text":"addPropertyToObservable","type":"Identifier","range":[602,625]},{"text":"result","type":"Identifier","range":[626,632]},{"text":"key","type":"Identifier","range":[634,637]},{"text":"value","type":"Identifier","range":[639,644]},{"text":"as","type":"Identifier","range":[655,657]},{"text":"T","type":"Identifier","range":[658,659]},{"text":"storeObservable","type":"Identifier","range":[665,680]},{"text":"observable","type":"Identifier","range":[681,691]},{"text":"rawToProxy","type":"Identifier","range":[697,707]},{"text":"set","type":"Identifier","range":[708,711]},{"text":"target","type":"Identifier","range":[712,718]},{"text":"observable","type":"Identifier","range":[720,730]},{"text":"proxyToRaw","type":"Identifier","range":[735,745]},{"text":"set","type":"Identifier","range":[746,749]},{"text":"observable","type":"Identifier","range":[750,760]},{"text":"target","type":"Identifier","range":[762,768]},{"text":"return","type":"Keyword","range":[774,780]},{"text":"observable","type":"Identifier","range":[781,791]},{"text":"const","type":"Keyword","range":[797,802]},{"text":"addPropertyToObservable","type":"Identifier","range":[803,826]},{"text":"T","type":"Identifier","range":[830,831]},{"text":"extends","type":"Keyword","range":[832,839]},{"text":"AnyObject","type":"Identifier","range":[840,849]},{"text":"K","type":"Identifier","range":[851,852]},{"text":"target","type":"Identifier","range":[857,863]},{"text":"T","type":"Identifier","range":[865,866]},{"text":"key","type":"Identifier","range":[870,873]},{"text":"string","type":"Identifier","range":[875,881]},{"text":"value","type":"Identifier","range":[885,890]},{"text":"K","type":"Identifier","range":[892,893]},{"text":"let","type":"Keyword","range":[903,906]},{"text":"currentValue","type":"Identifier","range":[907,919]},{"text":"value","type":"Identifier","range":[922,927]},{"text":"Object","type":"Identifier","range":[931,937]},{"text":"defineProperty","type":"Identifier","range":[938,952]},{"text":"target","type":"Identifier","range":[953,959]},{"text":"key","type":"Identifier","range":[961,964]},{"text":"get","type":"Identifier","range":[972,975]},{"text":"addReaction","type":"Identifier","range":[986,997]},{"text":"target","type":"Identifier","range":[998,1004]},{"text":"key","type":"Identifier","range":[1006,1009]},{"text":"return","type":"Keyword","range":[1018,1024]},{"text":"isObject","type":"Identifier","range":[1025,1033]},{"text":"currentValue","type":"Identifier","range":[1034,1046]},{"text":"observable","type":"Identifier","range":[1050,1060]},{"text":"currentValue","type":"Identifier","range":[1061,1073]},{"text":"currentValue","type":"Identifier","range":[1077,1089]},{"text":"set","type":"Identifier","range":[1102,1105]},{"text":"newValue","type":"Identifier","range":[1106,1114]},{"text":"if","type":"Keyword","range":[1124,1126]},{"text":"hasChanged","type":"Identifier","range":[1128,1138]},{"text":"currentValue","type":"Identifier","range":[1139,1151]},{"text":"newValue","type":"Identifier","range":[1153,1161]},{"text":"currentValue","type":"Identifier","range":[1174,1186]},{"text":"newValue","type":"Identifier","range":[1189,1197]},{"text":"runReactions","type":"Identifier","range":[1207,1219]},{"text":"target","type":"Identifier","range":[1220,1226]},{"text":"key","type":"Identifier","range":[1228,1231]},{"text":"return","type":"Keyword","range":[1258,1264]},{"text":"target","type":"Identifier","range":[1265,1271]}]}