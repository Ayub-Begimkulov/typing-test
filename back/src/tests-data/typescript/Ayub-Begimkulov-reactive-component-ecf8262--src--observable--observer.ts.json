{"type":"typescript","text":"export interface Reaction {\n  (): any;\n  __isReaction: boolean;\n  isRunning: boolean;\n  options: ReactionOptions;\n  deps: Set<Reaction>[];\n}\n\ninterface ReactionOptions {\n  lazy?: boolean;\n  scheduler?: (fn: Reaction) => any;\n}\n\nexport const runningReactions: Reaction[] = [];\n\nexport const observe = (fn: Function, options: ReactionOptions = {}) => {\n  const reaction = isReaction(fn) ? fn : makeReaction(fn);\n\n  reaction.__isReaction = true;\n  reaction.options = options;\n\n  if (!options.lazy) {\n    reaction();\n  }\n\n  return reaction;\n};\n\nconst makeReaction = (fn: Function) => {\n  const reaction = (() => {\n    // using isRunning instead of runningReactions.include\n    // for a O(1) look up\n    if (!reaction.isRunning) {\n      try {\n        cleanUpDeps(reaction);\n        reaction.isRunning = true;\n        runningReactions.push(reaction);\n        return fn();\n      } finally {\n        runningReactions.pop();\n        reaction.isRunning = false;\n      }\n    }\n  }) as Reaction;\n\n  return reaction;\n};\n\nconst cleanUpDeps = (reaction: Reaction) => {\n  const { deps } = reaction;\n  deps && deps.forEach(dep => dep.delete(reaction));\n  reaction.deps = [];\n};\n\nconst isReaction = (fn: any): fn is Reaction => {\n  return fn && fn.__isReaction;\n};","words":[{"text":"export","type":"Keyword","range":[0,6]},{"text":"interface","type":"Keyword","range":[7,16]},{"text":"Reaction","type":"Identifier","range":[17,25]},{"text":"any","type":"Identifier","range":[34,37]},{"text":"__isReaction","type":"Identifier","range":[41,53]},{"text":"boolean","type":"Identifier","range":[55,62]},{"text":"isRunning","type":"Identifier","range":[66,75]},{"text":"boolean","type":"Identifier","range":[77,84]},{"text":"options","type":"Identifier","range":[88,95]},{"text":"ReactionOptions","type":"Identifier","range":[97,112]},{"text":"deps","type":"Identifier","range":[116,120]},{"text":"Set","type":"Identifier","range":[122,125]},{"text":"Reaction","type":"Identifier","range":[126,134]},{"text":"interface","type":"Keyword","range":[142,151]},{"text":"ReactionOptions","type":"Identifier","range":[152,167]},{"text":"lazy","type":"Identifier","range":[172,176]},{"text":"boolean","type":"Identifier","range":[179,186]},{"text":"scheduler","type":"Identifier","range":[190,199]},{"text":"fn","type":"Identifier","range":[203,205]},{"text":"Reaction","type":"Identifier","range":[207,215]},{"text":"any","type":"Identifier","range":[220,223]},{"text":"export","type":"Keyword","range":[228,234]},{"text":"const","type":"Keyword","range":[235,240]},{"text":"runningReactions","type":"Identifier","range":[241,257]},{"text":"Reaction","type":"Identifier","range":[259,267]},{"text":"export","type":"Keyword","range":[277,283]},{"text":"const","type":"Keyword","range":[284,289]},{"text":"observe","type":"Identifier","range":[290,297]},{"text":"fn","type":"Identifier","range":[301,303]},{"text":"Function","type":"Identifier","range":[305,313]},{"text":"options","type":"Identifier","range":[315,322]},{"text":"ReactionOptions","type":"Identifier","range":[324,339]},{"text":"const","type":"Keyword","range":[353,358]},{"text":"reaction","type":"Identifier","range":[359,367]},{"text":"isReaction","type":"Identifier","range":[370,380]},{"text":"fn","type":"Identifier","range":[381,383]},{"text":"fn","type":"Identifier","range":[387,389]},{"text":"makeReaction","type":"Identifier","range":[392,404]},{"text":"fn","type":"Identifier","range":[405,407]},{"text":"reaction","type":"Identifier","range":[413,421]},{"text":"__isReaction","type":"Identifier","range":[422,434]},{"text":"true","type":"Boolean","range":[437,441]},{"text":"reaction","type":"Identifier","range":[445,453]},{"text":"options","type":"Identifier","range":[454,461]},{"text":"options","type":"Identifier","range":[464,471]},{"text":"if","type":"Keyword","range":[476,478]},{"text":"options","type":"Identifier","range":[481,488]},{"text":"lazy","type":"Identifier","range":[489,493]},{"text":"reaction","type":"Identifier","range":[501,509]},{"text":"return","type":"Keyword","range":[520,526]},{"text":"reaction","type":"Identifier","range":[527,535]},{"text":"const","type":"Keyword","range":[541,546]},{"text":"makeReaction","type":"Identifier","range":[547,559]},{"text":"fn","type":"Identifier","range":[563,565]},{"text":"Function","type":"Identifier","range":[567,575]},{"text":"const","type":"Keyword","range":[584,589]},{"text":"reaction","type":"Identifier","range":[590,598]},{"text":" using isRunning instead of runningReactions.include","type":"Line","range":[614,668]},{"text":" for a O(1) look up","type":"Line","range":[673,694]},{"text":"if","type":"Keyword","range":[699,701]},{"text":"reaction","type":"Identifier","range":[704,712]},{"text":"isRunning","type":"Identifier","range":[713,722]},{"text":"try","type":"Keyword","range":[732,735]},{"text":"cleanUpDeps","type":"Identifier","range":[746,757]},{"text":"reaction","type":"Identifier","range":[758,766]},{"text":"reaction","type":"Identifier","range":[777,785]},{"text":"isRunning","type":"Identifier","range":[786,795]},{"text":"true","type":"Boolean","range":[798,802]},{"text":"runningReactions","type":"Identifier","range":[812,828]},{"text":"push","type":"Identifier","range":[829,833]},{"text":"reaction","type":"Identifier","range":[834,842]},{"text":"return","type":"Keyword","range":[853,859]},{"text":"fn","type":"Identifier","range":[860,862]},{"text":"finally","type":"Keyword","range":[874,881]},{"text":"runningReactions","type":"Identifier","range":[892,908]},{"text":"pop","type":"Identifier","range":[909,912]},{"text":"reaction","type":"Identifier","range":[924,932]},{"text":"isRunning","type":"Identifier","range":[933,942]},{"text":"false","type":"Boolean","range":[945,950]},{"text":"as","type":"Identifier","range":[971,973]},{"text":"Reaction","type":"Identifier","range":[974,982]},{"text":"return","type":"Keyword","range":[987,993]},{"text":"reaction","type":"Identifier","range":[994,1002]},{"text":"const","type":"Keyword","range":[1008,1013]},{"text":"cleanUpDeps","type":"Identifier","range":[1014,1025]},{"text":"reaction","type":"Identifier","range":[1029,1037]},{"text":"Reaction","type":"Identifier","range":[1039,1047]},{"text":"const","type":"Keyword","range":[1056,1061]},{"text":"deps","type":"Identifier","range":[1064,1068]},{"text":"reaction","type":"Identifier","range":[1073,1081]},{"text":"deps","type":"Identifier","range":[1085,1089]},{"text":"deps","type":"Identifier","range":[1093,1097]},{"text":"forEach","type":"Identifier","range":[1098,1105]},{"text":"dep","type":"Identifier","range":[1106,1109]},{"text":"dep","type":"Identifier","range":[1113,1116]},{"text":"delete","type":"Keyword","range":[1117,1123]},{"text":"reaction","type":"Identifier","range":[1124,1132]},{"text":"reaction","type":"Identifier","range":[1138,1146]},{"text":"deps","type":"Identifier","range":[1147,1151]},{"text":"const","type":"Keyword","range":[1162,1167]},{"text":"isReaction","type":"Identifier","range":[1168,1178]},{"text":"fn","type":"Identifier","range":[1182,1184]},{"text":"any","type":"Identifier","range":[1186,1189]},{"text":"fn","type":"Identifier","range":[1192,1194]},{"text":"is","type":"Identifier","range":[1195,1197]},{"text":"Reaction","type":"Identifier","range":[1198,1206]},{"text":"return","type":"Keyword","range":[1214,1220]},{"text":"fn","type":"Identifier","range":[1221,1223]},{"text":"fn","type":"Identifier","range":[1227,1229]},{"text":"__isReaction","type":"Identifier","range":[1230,1242]}]}