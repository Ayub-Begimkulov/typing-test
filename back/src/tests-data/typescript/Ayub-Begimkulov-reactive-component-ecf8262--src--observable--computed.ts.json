{"type":"typescript","text":"import { observe } from \"./observer\";\nimport { addReaction, runReactions } from \"./store\";\n\ninterface Computed<T> {\n  readonly value: T;\n}\n\nexport const computed = <T>(getter: () => T) => {\n  let value: T;\n  let computed: Computed<T>;\n  let isDirty = true;\n\n  const runner = observe(getter, {\n    lazy: true,\n    scheduler: () => {\n      if (!isDirty) {\n        isDirty = true;\n        return runReactions(computed, \"value\");\n      }\n      return;\n    },\n  });\n\n  computed = {\n    get value() {\n      if (isDirty) {\n        value = runner();\n        isDirty = false;\n      }\n      addReaction(computed, \"value\");\n      return value;\n    },\n    set value(val) {\n      console.warn(\"asdf\", val);\n    },\n  };\n\n  return computed;\n};","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"observe","type":"Identifier","range":[9,16]},{"text":"from","type":"Identifier","range":[19,23]},{"text":"\"./observer\"","type":"String","range":[24,36]},{"text":"import","type":"Keyword","range":[38,44]},{"text":"addReaction","type":"Identifier","range":[47,58]},{"text":"runReactions","type":"Identifier","range":[60,72]},{"text":"from","type":"Identifier","range":[75,79]},{"text":"\"./store\"","type":"String","range":[80,89]},{"text":"interface","type":"Keyword","range":[92,101]},{"text":"Computed","type":"Identifier","range":[102,110]},{"text":"T","type":"Identifier","range":[111,112]},{"text":"readonly","type":"Identifier","range":[118,126]},{"text":"value","type":"Identifier","range":[127,132]},{"text":"T","type":"Identifier","range":[134,135]},{"text":"export","type":"Keyword","range":[140,146]},{"text":"const","type":"Keyword","range":[147,152]},{"text":"computed","type":"Identifier","range":[153,161]},{"text":"T","type":"Identifier","range":[165,166]},{"text":"getter","type":"Identifier","range":[168,174]},{"text":"T","type":"Identifier","range":[182,183]},{"text":"let","type":"Keyword","range":[192,195]},{"text":"value","type":"Identifier","range":[196,201]},{"text":"T","type":"Identifier","range":[203,204]},{"text":"let","type":"Keyword","range":[208,211]},{"text":"computed","type":"Identifier","range":[212,220]},{"text":"Computed","type":"Identifier","range":[222,230]},{"text":"T","type":"Identifier","range":[231,232]},{"text":"let","type":"Keyword","range":[237,240]},{"text":"isDirty","type":"Identifier","range":[241,248]},{"text":"true","type":"Boolean","range":[251,255]},{"text":"const","type":"Keyword","range":[260,265]},{"text":"runner","type":"Identifier","range":[266,272]},{"text":"observe","type":"Identifier","range":[275,282]},{"text":"getter","type":"Identifier","range":[283,289]},{"text":"lazy","type":"Identifier","range":[297,301]},{"text":"true","type":"Boolean","range":[303,307]},{"text":"scheduler","type":"Identifier","range":[313,322]},{"text":"if","type":"Keyword","range":[338,340]},{"text":"isDirty","type":"Identifier","range":[343,350]},{"text":"isDirty","type":"Identifier","range":[362,369]},{"text":"true","type":"Boolean","range":[372,376]},{"text":"return","type":"Keyword","range":[386,392]},{"text":"runReactions","type":"Identifier","range":[393,405]},{"text":"computed","type":"Identifier","range":[406,414]},{"text":"\"value\"","type":"String","range":[416,423]},{"text":"return","type":"Keyword","range":[440,446]},{"text":"computed","type":"Identifier","range":[464,472]},{"text":"get","type":"Identifier","range":[481,484]},{"text":"value","type":"Identifier","range":[485,490]},{"text":"if","type":"Keyword","range":[501,503]},{"text":"isDirty","type":"Identifier","range":[505,512]},{"text":"value","type":"Identifier","range":[524,529]},{"text":"runner","type":"Identifier","range":[532,538]},{"text":"isDirty","type":"Identifier","range":[550,557]},{"text":"false","type":"Boolean","range":[560,565]},{"text":"addReaction","type":"Identifier","range":[581,592]},{"text":"computed","type":"Identifier","range":[593,601]},{"text":"\"value\"","type":"String","range":[603,610]},{"text":"return","type":"Keyword","range":[619,625]},{"text":"value","type":"Identifier","range":[626,631]},{"text":"set","type":"Identifier","range":[644,647]},{"text":"value","type":"Identifier","range":[648,653]},{"text":"val","type":"Identifier","range":[654,657]},{"text":"console","type":"Identifier","range":[667,674]},{"text":"warn","type":"Identifier","range":[675,679]},{"text":"\"asdf\"","type":"String","range":[680,686]},{"text":"val","type":"Identifier","range":[688,691]},{"text":"return","type":"Keyword","range":[709,715]},{"text":"computed","type":"Identifier","range":[716,724]}]}