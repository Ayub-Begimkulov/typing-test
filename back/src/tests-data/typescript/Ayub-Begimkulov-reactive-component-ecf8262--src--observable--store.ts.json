{"type":"typescript","text":"import { AnyObject } from \"../types\";\nimport { Reaction, runningReactions } from \"./observer\";\nimport { makeSet } from \"../utils\";\n\ntype ReactionsMap = Map<string, Set<Reaction>>;\n\nconst reactionsStore = new WeakMap<AnyObject, ReactionsMap>();\n\nexport const storeObservable = (obj: AnyObject) => {\n  reactionsStore.set(obj, new Map());\n};\n\nexport const addReaction = (obj: AnyObject, key: string) => {\n  const currentReaction = runningReactions[runningReactions.length - 1];\n  if (!currentReaction) {\n    return;\n  }\n  const reactionsForObj = reactionsStore.get(obj);\n  if (!reactionsForObj) {\n    return;\n  }\n  let reactionsForKey = reactionsForObj.get(key);\n  if (!reactionsForKey) {\n    reactionsForKey = new Set();\n    reactionsForObj.set(key, reactionsForKey);\n  }\n  if (!reactionsForKey.has(currentReaction)) {\n    reactionsForKey.add(currentReaction);\n    currentReaction.deps.push(reactionsForKey);\n  }\n};\n\nexport const runReactions = (obj: AnyObject, key: string) => {\n  const reactionsForObj = reactionsStore.get(obj);\n  const reactionsForKey = reactionsForObj && reactionsForObj.get(key);\n  if (!reactionsForKey) {\n    return;\n  }\n  // make a copy of reactions to not end up in an infinite loop\n  const reactionsToRun = makeSet(reactionsForKey);\n  reactionsToRun.forEach(reaction => {\n    if (reaction.options.scheduler) {\n      reaction.options.scheduler(reaction);\n    } else {\n      reaction();\n    }\n  });\n};","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"AnyObject","type":"Identifier","range":[9,18]},{"text":"from","type":"Identifier","range":[21,25]},{"text":"\"../types\"","type":"String","range":[26,36]},{"text":"import","type":"Keyword","range":[38,44]},{"text":"Reaction","type":"Identifier","range":[47,55]},{"text":"runningReactions","type":"Identifier","range":[57,73]},{"text":"from","type":"Identifier","range":[76,80]},{"text":"\"./observer\"","type":"String","range":[81,93]},{"text":"import","type":"Keyword","range":[95,101]},{"text":"makeSet","type":"Identifier","range":[104,111]},{"text":"from","type":"Identifier","range":[114,118]},{"text":"\"../utils\"","type":"String","range":[119,129]},{"text":"type","type":"Identifier","range":[132,136]},{"text":"ReactionsMap","type":"Identifier","range":[137,149]},{"text":"Map","type":"Identifier","range":[152,155]},{"text":"string","type":"Identifier","range":[156,162]},{"text":"Set","type":"Identifier","range":[164,167]},{"text":"Reaction","type":"Identifier","range":[168,176]},{"text":"const","type":"Keyword","range":[181,186]},{"text":"reactionsStore","type":"Identifier","range":[187,201]},{"text":"new","type":"Keyword","range":[204,207]},{"text":"WeakMap","type":"Identifier","range":[208,215]},{"text":"AnyObject","type":"Identifier","range":[216,225]},{"text":"ReactionsMap","type":"Identifier","range":[227,239]},{"text":"export","type":"Keyword","range":[245,251]},{"text":"const","type":"Keyword","range":[252,257]},{"text":"storeObservable","type":"Identifier","range":[258,273]},{"text":"obj","type":"Identifier","range":[277,280]},{"text":"AnyObject","type":"Identifier","range":[282,291]},{"text":"reactionsStore","type":"Identifier","range":[300,314]},{"text":"set","type":"Identifier","range":[315,318]},{"text":"obj","type":"Identifier","range":[319,322]},{"text":"new","type":"Keyword","range":[324,327]},{"text":"Map","type":"Identifier","range":[328,331]},{"text":"export","type":"Keyword","range":[340,346]},{"text":"const","type":"Keyword","range":[347,352]},{"text":"addReaction","type":"Identifier","range":[353,364]},{"text":"obj","type":"Identifier","range":[368,371]},{"text":"AnyObject","type":"Identifier","range":[373,382]},{"text":"key","type":"Identifier","range":[384,387]},{"text":"string","type":"Identifier","range":[389,395]},{"text":"const","type":"Keyword","range":[404,409]},{"text":"currentReaction","type":"Identifier","range":[410,425]},{"text":"runningReactions","type":"Identifier","range":[428,444]},{"text":"runningReactions","type":"Identifier","range":[445,461]},{"text":"length","type":"Identifier","range":[462,468]},{"text":"1","type":"Numeric","range":[471,472]},{"text":"if","type":"Keyword","range":[477,479]},{"text":"currentReaction","type":"Identifier","range":[482,497]},{"text":"return","type":"Keyword","range":[505,511]},{"text":"const","type":"Keyword","range":[519,524]},{"text":"reactionsForObj","type":"Identifier","range":[525,540]},{"text":"reactionsStore","type":"Identifier","range":[543,557]},{"text":"get","type":"Identifier","range":[558,561]},{"text":"obj","type":"Identifier","range":[562,565]},{"text":"if","type":"Keyword","range":[570,572]},{"text":"reactionsForObj","type":"Identifier","range":[575,590]},{"text":"return","type":"Keyword","range":[598,604]},{"text":"let","type":"Keyword","range":[612,615]},{"text":"reactionsForKey","type":"Identifier","range":[616,631]},{"text":"reactionsForObj","type":"Identifier","range":[634,649]},{"text":"get","type":"Identifier","range":[650,653]},{"text":"key","type":"Identifier","range":[654,657]},{"text":"if","type":"Keyword","range":[662,664]},{"text":"reactionsForKey","type":"Identifier","range":[667,682]},{"text":"reactionsForKey","type":"Identifier","range":[690,705]},{"text":"new","type":"Keyword","range":[708,711]},{"text":"Set","type":"Identifier","range":[712,715]},{"text":"reactionsForObj","type":"Identifier","range":[723,738]},{"text":"set","type":"Identifier","range":[739,742]},{"text":"key","type":"Identifier","range":[743,746]},{"text":"reactionsForKey","type":"Identifier","range":[748,763]},{"text":"if","type":"Keyword","range":[772,774]},{"text":"reactionsForKey","type":"Identifier","range":[777,792]},{"text":"has","type":"Identifier","range":[793,796]},{"text":"currentReaction","type":"Identifier","range":[797,812]},{"text":"reactionsForKey","type":"Identifier","range":[821,836]},{"text":"add","type":"Identifier","range":[837,840]},{"text":"currentReaction","type":"Identifier","range":[841,856]},{"text":"currentReaction","type":"Identifier","range":[863,878]},{"text":"deps","type":"Identifier","range":[879,883]},{"text":"push","type":"Identifier","range":[884,888]},{"text":"reactionsForKey","type":"Identifier","range":[889,904]},{"text":"export","type":"Keyword","range":[915,921]},{"text":"const","type":"Keyword","range":[922,927]},{"text":"runReactions","type":"Identifier","range":[928,940]},{"text":"obj","type":"Identifier","range":[944,947]},{"text":"AnyObject","type":"Identifier","range":[949,958]},{"text":"key","type":"Identifier","range":[960,963]},{"text":"string","type":"Identifier","range":[965,971]},{"text":"const","type":"Keyword","range":[980,985]},{"text":"reactionsForObj","type":"Identifier","range":[986,1001]},{"text":"reactionsStore","type":"Identifier","range":[1004,1018]},{"text":"get","type":"Identifier","range":[1019,1022]},{"text":"obj","type":"Identifier","range":[1023,1026]},{"text":"const","type":"Keyword","range":[1031,1036]},{"text":"reactionsForKey","type":"Identifier","range":[1037,1052]},{"text":"reactionsForObj","type":"Identifier","range":[1055,1070]},{"text":"reactionsForObj","type":"Identifier","range":[1074,1089]},{"text":"get","type":"Identifier","range":[1090,1093]},{"text":"key","type":"Identifier","range":[1094,1097]},{"text":"if","type":"Keyword","range":[1102,1104]},{"text":"reactionsForKey","type":"Identifier","range":[1107,1122]},{"text":"return","type":"Keyword","range":[1130,1136]},{"text":" make a copy of reactions to not end up in an infinite loop","type":"Line","range":[1144,1205]},{"text":"const","type":"Keyword","range":[1208,1213]},{"text":"reactionsToRun","type":"Identifier","range":[1214,1228]},{"text":"makeSet","type":"Identifier","range":[1231,1238]},{"text":"reactionsForKey","type":"Identifier","range":[1239,1254]},{"text":"reactionsToRun","type":"Identifier","range":[1259,1273]},{"text":"forEach","type":"Identifier","range":[1274,1281]},{"text":"reaction","type":"Identifier","range":[1282,1290]},{"text":"if","type":"Keyword","range":[1300,1302]},{"text":"reaction","type":"Identifier","range":[1304,1312]},{"text":"options","type":"Identifier","range":[1313,1320]},{"text":"scheduler","type":"Identifier","range":[1321,1330]},{"text":"reaction","type":"Identifier","range":[1340,1348]},{"text":"options","type":"Identifier","range":[1349,1356]},{"text":"scheduler","type":"Identifier","range":[1357,1366]},{"text":"reaction","type":"Identifier","range":[1367,1375]},{"text":"else","type":"Keyword","range":[1384,1388]},{"text":"reaction","type":"Identifier","range":[1397,1405]}]}