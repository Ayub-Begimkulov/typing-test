{"type":"typescript","text":"import { BEFORE_DESTROY } from \"./life-cycle\";\nimport { AnyObject } from \"../types\";\n\ninterface ComponentOptions<T> {\n  root: Element | string;\n  elements?: Record<string, string>;\n  setup: SetUpFunction<T>;\n}\n\ntype ElementsMap = Record<string, Element>;\ntype SetUpFunction<T> = (ctx: { elements: ElementsMap }) => T;\n\nexport let currentInstance: Component<any> | null = null;\n\nexport const setCurrentInstance = (instance: Component<any> | null) => {\n  currentInstance = instance;\n};\n\nexport class Component<T extends AnyObject> {\n  root: Element;\n  state?: T;\n  setup: SetUpFunction<T>;\n  hooks = new Map<string, Set<Function>>();\n  elementsSelectors: Record<string, string>;\n\n  constructor({ root, setup, elements = {} }: ComponentOptions<T>) {\n    const rootElement =\n      typeof root === \"string\" ? document.querySelector(root) : root;\n\n    if (!rootElement) {\n      throw new TypeError(\n        \"root must be an element, or a selector of an existing element\"\n      );\n    }\n\n    this.root = rootElement;\n    this.setup = setup;\n    this.elementsSelectors = elements;\n\n    this.init();\n  }\n\n  init() {\n    setCurrentInstance(this);\n    const { setup } = this;\n    const elements = this.getElements();\n    this.state = setup({ elements });\n    setCurrentInstance(null);\n  }\n\n  getElements() {\n    const { root, elementsSelectors } = this;\n\n    return Object.entries(elementsSelectors).reduce(\n      (acc, [name, selector]) => {\n        const element = document.querySelector(selector);\n        if (element) {\n          acc[name] = element;\n        }\n        return acc;\n      },\n      { root } as ElementsMap\n    );\n  }\n\n  destroy() {\n    this.hooks.get(BEFORE_DESTROY)?.forEach((fn) => fn());\n    this.hooks.clear();\n  }\n}","words":[{"text":"import","type":"Keyword","range":[0,6]},{"text":"BEFORE_DESTROY","type":"Identifier","range":[9,23]},{"text":"from","type":"Identifier","range":[26,30]},{"text":"\"./life-cycle\"","type":"String","range":[31,45]},{"text":"import","type":"Keyword","range":[47,53]},{"text":"AnyObject","type":"Identifier","range":[56,65]},{"text":"from","type":"Identifier","range":[68,72]},{"text":"\"../types\"","type":"String","range":[73,83]},{"text":"interface","type":"Keyword","range":[86,95]},{"text":"ComponentOptions","type":"Identifier","range":[96,112]},{"text":"T","type":"Identifier","range":[113,114]},{"text":"root","type":"Identifier","range":[120,124]},{"text":"Element","type":"Identifier","range":[126,133]},{"text":"string","type":"Identifier","range":[136,142]},{"text":"elements","type":"Identifier","range":[146,154]},{"text":"Record","type":"Identifier","range":[157,163]},{"text":"string","type":"Identifier","range":[164,170]},{"text":"string","type":"Identifier","range":[172,178]},{"text":"setup","type":"Identifier","range":[183,188]},{"text":"SetUpFunction","type":"Identifier","range":[190,203]},{"text":"T","type":"Identifier","range":[204,205]},{"text":"type","type":"Identifier","range":[211,215]},{"text":"ElementsMap","type":"Identifier","range":[216,227]},{"text":"Record","type":"Identifier","range":[230,236]},{"text":"string","type":"Identifier","range":[237,243]},{"text":"Element","type":"Identifier","range":[245,252]},{"text":"type","type":"Identifier","range":[255,259]},{"text":"SetUpFunction","type":"Identifier","range":[260,273]},{"text":"T","type":"Identifier","range":[274,275]},{"text":"ctx","type":"Identifier","range":[280,283]},{"text":"elements","type":"Identifier","range":[287,295]},{"text":"ElementsMap","type":"Identifier","range":[297,308]},{"text":"T","type":"Identifier","range":[315,316]},{"text":"export","type":"Keyword","range":[319,325]},{"text":"let","type":"Keyword","range":[326,329]},{"text":"currentInstance","type":"Identifier","range":[330,345]},{"text":"Component","type":"Identifier","range":[347,356]},{"text":"any","type":"Identifier","range":[357,360]},{"text":"null","type":"Keyword","range":[364,368]},{"text":"null","type":"Keyword","range":[371,375]},{"text":"export","type":"Keyword","range":[378,384]},{"text":"const","type":"Keyword","range":[385,390]},{"text":"setCurrentInstance","type":"Identifier","range":[391,409]},{"text":"instance","type":"Identifier","range":[413,421]},{"text":"Component","type":"Identifier","range":[423,432]},{"text":"any","type":"Identifier","range":[433,436]},{"text":"null","type":"Keyword","range":[440,444]},{"text":"currentInstance","type":"Identifier","range":[453,468]},{"text":"instance","type":"Identifier","range":[471,479]},{"text":"export","type":"Keyword","range":[485,491]},{"text":"class","type":"Keyword","range":[492,497]},{"text":"Component","type":"Identifier","range":[498,507]},{"text":"T","type":"Identifier","range":[508,509]},{"text":"extends","type":"Keyword","range":[510,517]},{"text":"AnyObject","type":"Identifier","range":[518,527]},{"text":"root","type":"Identifier","range":[533,537]},{"text":"Element","type":"Identifier","range":[539,546]},{"text":"state","type":"Identifier","range":[550,555]},{"text":"T","type":"Identifier","range":[558,559]},{"text":"setup","type":"Identifier","range":[563,568]},{"text":"SetUpFunction","type":"Identifier","range":[570,583]},{"text":"T","type":"Identifier","range":[584,585]},{"text":"hooks","type":"Identifier","range":[590,595]},{"text":"new","type":"Keyword","range":[598,601]},{"text":"Map","type":"Identifier","range":[602,605]},{"text":"string","type":"Identifier","range":[606,612]},{"text":"Set","type":"Identifier","range":[614,617]},{"text":"Function","type":"Identifier","range":[618,626]},{"text":"elementsSelectors","type":"Identifier","range":[634,651]},{"text":"Record","type":"Identifier","range":[653,659]},{"text":"string","type":"Identifier","range":[660,666]},{"text":"string","type":"Identifier","range":[668,674]},{"text":"constructor","type":"Identifier","range":[680,691]},{"text":"root","type":"Identifier","range":[694,698]},{"text":"setup","type":"Identifier","range":[700,705]},{"text":"elements","type":"Identifier","range":[707,715]},{"text":"ComponentOptions","type":"Identifier","range":[724,740]},{"text":"T","type":"Identifier","range":[741,742]},{"text":"const","type":"Keyword","range":[751,756]},{"text":"rootElement","type":"Identifier","range":[757,768]},{"text":"typeof","type":"Keyword","range":[777,783]},{"text":"root","type":"Identifier","range":[784,788]},{"text":"\"string\"","type":"String","range":[793,801]},{"text":"document","type":"Identifier","range":[804,812]},{"text":"querySelector","type":"Identifier","range":[813,826]},{"text":"root","type":"Identifier","range":[827,831]},{"text":"root","type":"Identifier","range":[835,839]},{"text":"if","type":"Keyword","range":[846,848]},{"text":"rootElement","type":"Identifier","range":[851,862]},{"text":"throw","type":"Keyword","range":[872,877]},{"text":"new","type":"Keyword","range":[878,881]},{"text":"TypeError","type":"Identifier","range":[882,891]},{"text":"\"root must be an element, or a selector of an existing element\"","type":"String","range":[901,964]},{"text":"this","type":"Keyword","range":[985,989]},{"text":"root","type":"Identifier","range":[990,994]},{"text":"rootElement","type":"Identifier","range":[997,1008]},{"text":"this","type":"Keyword","range":[1014,1018]},{"text":"setup","type":"Identifier","range":[1019,1024]},{"text":"setup","type":"Identifier","range":[1027,1032]},{"text":"this","type":"Keyword","range":[1038,1042]},{"text":"elementsSelectors","type":"Identifier","range":[1043,1060]},{"text":"elements","type":"Identifier","range":[1063,1071]},{"text":"this","type":"Keyword","range":[1078,1082]},{"text":"init","type":"Identifier","range":[1083,1087]},{"text":"init","type":"Identifier","range":[1098,1102]},{"text":"setCurrentInstance","type":"Identifier","range":[1111,1129]},{"text":"this","type":"Keyword","range":[1130,1134]},{"text":"const","type":"Keyword","range":[1141,1146]},{"text":"setup","type":"Identifier","range":[1149,1154]},{"text":"this","type":"Keyword","range":[1159,1163]},{"text":"const","type":"Keyword","range":[1169,1174]},{"text":"elements","type":"Identifier","range":[1175,1183]},{"text":"this","type":"Keyword","range":[1186,1190]},{"text":"getElements","type":"Identifier","range":[1191,1202]},{"text":"this","type":"Keyword","range":[1210,1214]},{"text":"state","type":"Identifier","range":[1215,1220]},{"text":"setup","type":"Identifier","range":[1223,1228]},{"text":"elements","type":"Identifier","range":[1231,1239]},{"text":"setCurrentInstance","type":"Identifier","range":[1248,1266]},{"text":"null","type":"Keyword","range":[1267,1271]},{"text":"getElements","type":"Identifier","range":[1281,1292]},{"text":"const","type":"Keyword","range":[1301,1306]},{"text":"root","type":"Identifier","range":[1309,1313]},{"text":"elementsSelectors","type":"Identifier","range":[1315,1332]},{"text":"this","type":"Keyword","range":[1337,1341]},{"text":"return","type":"Keyword","range":[1348,1354]},{"text":"Object","type":"Identifier","range":[1355,1361]},{"text":"entries","type":"Identifier","range":[1362,1369]},{"text":"elementsSelectors","type":"Identifier","range":[1370,1387]},{"text":"reduce","type":"Identifier","range":[1389,1395]},{"text":"acc","type":"Identifier","range":[1404,1407]},{"text":"name","type":"Identifier","range":[1410,1414]},{"text":"selector","type":"Identifier","range":[1416,1424]},{"text":"const","type":"Keyword","range":[1440,1445]},{"text":"element","type":"Identifier","range":[1446,1453]},{"text":"document","type":"Identifier","range":[1456,1464]},{"text":"querySelector","type":"Identifier","range":[1465,1478]},{"text":"selector","type":"Identifier","range":[1479,1487]},{"text":"if","type":"Keyword","range":[1498,1500]},{"text":"element","type":"Identifier","range":[1502,1509]},{"text":"acc","type":"Identifier","range":[1523,1526]},{"text":"name","type":"Identifier","range":[1527,1531]},{"text":"element","type":"Identifier","range":[1535,1542]},{"text":"return","type":"Keyword","range":[1562,1568]},{"text":"acc","type":"Identifier","range":[1569,1572]},{"text":"root","type":"Identifier","range":[1591,1595]},{"text":"as","type":"Identifier","range":[1598,1600]},{"text":"ElementsMap","type":"Identifier","range":[1601,1612]},{"text":"destroy","type":"Identifier","range":[1627,1634]},{"text":"this","type":"Keyword","range":[1643,1647]},{"text":"hooks","type":"Identifier","range":[1648,1653]},{"text":"get","type":"Identifier","range":[1654,1657]},{"text":"BEFORE_DESTROY","type":"Identifier","range":[1658,1672]},{"text":"forEach","type":"Identifier","range":[1675,1682]},{"text":"fn","type":"Identifier","range":[1684,1686]},{"text":"fn","type":"Identifier","range":[1691,1693]},{"text":"this","type":"Keyword","range":[1702,1706]},{"text":"hooks","type":"Identifier","range":[1707,1712]},{"text":"clear","type":"Identifier","range":[1713,1718]}]}